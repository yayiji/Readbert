# VS-Dilbert Copilot Instructions

## Architecture Overview

This is a **SvelteKit + Svelte 5** application for browsing 34 years of Dilbert comics (1989-2023) with AI transcriptions. The app is statically deployable and runs entirely client-side.

### Key Design Patterns

- **Static Asset Structure**: Comics live in `/static/dilbert-comics/{year}/{YYYY-MM-DD}.gif` with transcripts in `/static/dilbert-transcripts/{year}/{YYYY-MM-DD}.txt`
- **Browser-Only Loading**: All comic loading happens client-side via fetch - no server APIs. Files in `src/lib/` handle all data management.
- **Date-Based Navigation**: Core navigation revolves around `YYYY-MM-DD` date strings with validation against `COMIC_DATE_RANGES` in `comicsClient.js`

## Svelte 5 Specifics

This project uses **modern Svelte 5 syntax** - avoid legacy patterns:

- Use `$state()`, `$derived()`, `$effect()` instead of stores/reactive statements
- Use `$bindable()` for component props that parent can modify
- Event handlers are `onclick={}` not `on:click={}`
- NO `onMount`/`onDestroy` - use `$effect()` with cleanup returns

See `SVELTE5_IMPROVEMENTS.md` for migration details.

## Key Files & Responsibilities

- **`src/routes/+page.svelte`**: Main comic viewer with navigation, localStorage caching, transcript loading
- **`src/lib/comicsClient.js`**: Core data layer - contains `COMIC_DATE_RANGES`, date validation, comic fetching
- **`src/lib/browserLoader.js`**: Higher-level loading functions (`loadComicBrowser`, `loadRandomComicBrowser`)
- **`src/lib/comicsUtils.js`**: Date parsing, filename handling, transcript loading utilities
- **`src/lib/CommandPaletteSearch.svelte`**: Full-text search using prebuilt search index

## Critical Developer Workflows

### Adding New Comics/Years
1. Add entries to `COMIC_DATE_RANGES` in `comicsClient.js` 
2. Place files in `static/dilbert-comics/{year}/` and `static/dilbert-transcripts/{year}/`
3. Run `npm run generate-search-index` to update search

### Development Commands
- `npm run dev` - Development server
- `npm run build` - Production build (static)
- `npm run generate-search-index` - Rebuild search index after transcript changes
- `npm run transcribe:gemini` - Generate AI transcriptions (requires Google API key)

## State Management Patterns

- **Local Storage**: Comics cached with 7-day expiry using `STORAGE_KEY` pattern in `+page.svelte`
- **URL State**: Date persists in URL, component watches `$page.url.searchParams`
- **Loading States**: Use `isLoading`, `isLoadingTranscript` states for async operations

## Search Architecture

Search uses a precomputed index (`static/search-index.json`) generated by `scripts/generateSearchIndex.js`. The search component (`CommandPaletteSearch.svelte`) loads this index on-demand and provides real-time filtering with highlighted results.

## Date Handling Gotchas

- Comics don't exist for all dates (weekends, holidays). Always validate with `isValidComicDateRange()`
- Navigation functions (`getPreviousComic`, `getNextComic`) automatically skip invalid dates
- First comic: `1989-04-16`, Last comic: `2023-03-12` (hardcoded in `COMIC_DATE_RANGES`)

## Deployment Notes

- Uses `@sveltejs/adapter-auto` for Vercel/static deployment
- All assets are static - no server-side processing required
- Search index should be regenerated when transcripts change